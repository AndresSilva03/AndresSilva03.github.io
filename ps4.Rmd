---
title: "Problem-set 4"
author: "Andres Silva"
date: "2024-06-05"
output: html_document
---

```{r setup, echo = NULL}

knitr::opts_chunk$set(echo = TRUE)

rm(list=ls())

require(pacman)
p_load(pacman, rio, data.table, tidyverse,
       sf, rvest, ggplot2,
       mapview, tmaptools, osmdata, viridis)

```



Esta página contiene todo el código del último problem set del curso.

## 1. Extraer información de internet:


#### 1.1. Obtener las URL
```{r 1.1}


#1.1.
url <- "https://eduard-martinez.github.io/pset-4.html"

html <- read_html(url)

table <- html %>% html_table()
table <- table[[1]] 
url_full <- as.matrix(table$url)
## Al haber extrído las urls de la tabla, ya aseguramos que solo están las que contienen
# la extensión de propiedad. Por esto, url_subset = url_full


```


#### 1.2. Filtrar las URL
```{r 1.2}

## Al haber extrído las urls de la tabla, ya aseguramos que solo están las que contienen
# la extensión de propiedad. Por esto, url_subset = url_full

url_subset <- url_full

```


#### 1.3. Extraer las tablas de los HTML:
```{r 1.3}

lista_tablas <- list()
  
for (i in 1:length(url_subset)) {
  
  htread <- read_html(url_subset[i])
  
  lista_tablas[i] <- html_table(htread)
  
}
  
```


#### 1.4. Preparar información:
```{r 1.4}


db_house <- rbindlist(lista_tablas, fill=TRUE, idcol=TRUE)

```

## 2. Manipular información GIS:


#### 2.1. Cree un objeto sf:
```{r 2.1}

sf_house <- st_as_sf(db_house, coords = c("lon","lat"), crs = 4326)

```


#### 2.2. Pintar mapa:
```{r 2.2}

bog <- opq(bbox = getbb("Bogota Colombia")) %>%
       add_osm_feature(key="boundary", value="administrative") %>% 
       osmdata_sf()
bog <- bog$osm_multipolygons %>% subset(admin_level==9 & !osm_id %in% 16011743:16011744)



house_map <- ggplot() +   geom_sf(mapping = aes(),data = bog) + geom_sf(mapping = aes(color = price), data = sf_house) + scale_color_viridis(option = "D")

ggsave("house_map.png", plot = house_map, width = 10, height = 8, dpi = 300)

file.show("house_map.png")



```




## 3. Bonos:

#### 3.1 R-Markdown: todo fue realizado en RMD
#### Estadísticas descriptivas:


#### 3.2. HTML en github:

<A HREF="https://github.com/AndresSilva03/AndresSilva03.github.io"> Link hacia el repositorio de la página </A>

